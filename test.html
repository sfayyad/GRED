<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" type="text/javascript"></script>
    <meta charset="utf-8"/>
    <script type="text/javascript">
    google.charts.load('visualization', '1', {packages: ['controls']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart () {

        // Create our data table.
        var jsonData = $.ajax({
        url: "Data.json",
		    type:'get',
        dataType: "json",
        async: false
        }).responseText; 

        var data = new google.visualization.DataTable(jsonData);

        var columnsTable = new google.visualization.DataTable();
        columnsTable.addColumn('number', 'colIndex');
        columnsTable.addColumn('string', 'colLabel');
        var initState= {selectedValues: []};
        // put the columns into this data table (skip column 0)
        for (var i = 1; i < data.getNumberOfColumns(); i++) {
            columnsTable.addRow([i, data.getColumnLabel(i)]);
            initState.selectedValues.push(data.getColumnLabel(i));
        }
        
        var chart = new google.visualization.ChartWrapper({
            chartType: 'BarChart',
            containerId: 'chart_div',
            dataTable: data,
            options: {
                title: 'Data',
                width: 600,
                height: 400
            }
        });
        
        var columnFilter = new google.visualization.ControlWrapper({
            controlType: 'CategoryFilter',
            containerId: 'colFilter_div',
            dataTable: columnsTable,
            options: {
                filterColumnLabel: 'colLabel',
                ui: {
                    label: 'Columns',
                    allowTyping: false,
                    allowMultiple: true,
                    allowNone: false,
                    selectedValuesLayout: 'belowStacked'
                }
            },
            state: initState
        });
        
        function setChartView () {
            var state = columnFilter.getState();
            var row;
            var view = {
                columns: [0]
            };
            for (var i = 0; i < state.selectedValues.length; i++) {
                row = columnsTable.getFilteredRows([{column: 1, value: state.selectedValues[i]}])[0];
                view.columns.push(columnsTable.getValue(row, 0));
            }
            // sort the indices into their original order
            view.columns.sort(function (a, b) {
                return (a - b);
            });
            chart.setView(view);
            chart.draw();
        }
        google.visualization.events.addListener(columnFilter, 'statechange', setChartView);
        
        setChartView();
        columnFilter.draw();
    }
    </script>
  </head>

  <body>
    <!--Div that will hold the dashboard-->
    <div id="colFilter_div"></div>
    <div id="chart_div"></div>
  </body>
</html>
